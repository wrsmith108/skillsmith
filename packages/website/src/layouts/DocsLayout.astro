---
import BaseLayout from './BaseLayout.astro';
import DocsSidebar from '../components/DocsSidebar.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Skillsmith Documentation' } = Astro.props;
const currentPath = Astro.url.pathname;
---

<BaseLayout title={`${title} | Skillsmith Docs`} description={description}>
  <div class="flex min-h-[calc(100vh-4rem)]">
    <!-- Sidebar -->
    <DocsSidebar currentPath={currentPath} />

    <!-- Main Content -->
    <main class="flex-1 min-w-0 px-8 py-10 lg:px-12">
      <article class="docs-content max-w-3xl">
        <slot />
      </article>
    </main>

    <!-- Table of Contents -->
    <aside class="hidden xl:block w-56 shrink-0 py-10 pr-8">
      <div class="sticky top-24">
        <h4 class="text-xs font-semibold uppercase tracking-wider text-dark-500 mb-4">On this page</h4>
        <nav class="toc-nav" id="toc">
          <!-- Generated by JavaScript -->
        </nav>
      </div>
    </aside>
  </div>

  <script>
    // Generate table of contents from headings
    document.addEventListener('DOMContentLoaded', () => {
      const article = document.querySelector('.docs-content');
      const toc = document.getElementById('toc');

      if (!article || !toc) return;

      const headings = article.querySelectorAll('h2, h3');
      if (headings.length === 0) return;

      const ul = document.createElement('ul');
      ul.className = 'space-y-2';

      headings.forEach((heading, index) => {
        if (!heading.id) {
          heading.id = `heading-${index}`;
        }

        const li = document.createElement('li');
        li.className = heading.tagName === 'H3' ? 'pl-3' : '';

        const a = document.createElement('a');
        a.href = `#${heading.id}`;
        a.className = 'text-sm text-dark-400 hover:text-primary-400 transition-colors block py-1';
        a.textContent = heading.textContent;

        li.appendChild(a);
        ul.appendChild(li);
      });

      toc.appendChild(ul);
    });
  </script>
</BaseLayout>

<style is:global>
  /* Documentation Content Styles */
  .docs-content h1 {
    @apply text-3xl lg:text-4xl font-bold text-white mb-4;
  }

  .docs-content .lead {
    @apply text-lg text-dark-300 mb-8;
  }

  .docs-content h2 {
    @apply text-xl lg:text-2xl font-semibold text-white mt-10 mb-4 pt-6 border-t border-dark-800;
  }

  .docs-content h2:first-of-type {
    @apply border-t-0 pt-0;
  }

  .docs-content h3 {
    @apply text-lg font-semibold text-white mt-6 mb-3;
  }

  .docs-content h4 {
    @apply text-base font-semibold text-dark-200 mt-4 mb-2;
  }

  .docs-content p {
    @apply text-dark-300 leading-relaxed mb-4;
  }

  .docs-content ul,
  .docs-content ol {
    @apply text-dark-300 mb-4 pl-6 space-y-2;
  }

  .docs-content ul {
    @apply list-disc;
  }

  .docs-content ol {
    @apply list-decimal;
  }

  .docs-content li {
    @apply leading-relaxed;
  }

  .docs-content a {
    @apply text-primary-400 hover:text-primary-300 underline underline-offset-2;
  }

  .docs-content code {
    @apply font-mono text-sm bg-dark-800 text-primary-300 px-1.5 py-0.5 rounded;
  }

  .docs-content pre {
    @apply bg-dark-900 border border-dark-800 rounded-lg p-4 mb-4 overflow-x-auto;
  }

  .docs-content pre code {
    @apply bg-transparent px-0 py-0 text-dark-200;
  }

  .docs-content strong {
    @apply text-dark-100 font-semibold;
  }

  .docs-content table {
    @apply w-full text-sm mb-6 border-collapse;
  }

  .docs-content th {
    @apply text-left font-semibold text-dark-200 bg-dark-900 px-4 py-3 border border-dark-800;
  }

  .docs-content td {
    @apply text-dark-300 px-4 py-3 border border-dark-800;
  }

  .docs-content .callout {
    @apply bg-dark-900 border-l-4 border-primary-500 px-5 py-4 rounded-r-lg mb-6;
  }

  .docs-content .callout.warning {
    @apply border-amber-500;
  }

  .docs-content .callout h4 {
    @apply text-primary-400 mt-0 mb-2;
  }

  .docs-content .callout.warning h4 {
    @apply text-amber-400;
  }

  .docs-content .callout p {
    @apply mb-0;
  }

  .docs-content .card-grid {
    @apply grid grid-cols-1 md:grid-cols-2 gap-4 my-6;
  }

  .docs-content .doc-card {
    @apply block p-5 bg-dark-900 border border-dark-800 rounded-lg no-underline transition-all hover:border-primary-500/50 hover:shadow-lg hover:shadow-primary-500/10;
  }

  .docs-content .doc-card h3 {
    @apply text-white mt-0 mb-2;
  }

  .docs-content .doc-card p {
    @apply text-dark-400 mb-0 text-sm;
  }
</style>
