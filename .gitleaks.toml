# Gitleaks configuration for Skillsmith
# https://github.com/gitleaks/gitleaks

title = "Skillsmith Secret Detection"

[extend]
# Use the default gitleaks config as a base
useDefault = true

# Custom rules for project-specific secrets
[[rules]]
id = "linear-api-key"
description = "Linear API Key"
regex = '''lin_api_[a-zA-Z0-9]{32,}'''
tags = ["api", "linear"]

[[rules]]
id = "linear-project-id"
description = "Linear Project UUID (potential workspace exposure)"
regex = '''["\']?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}["\']?'''
tags = ["uuid", "linear"]
# Only flag if it looks like it's being used as a project ID in code
keywords = ["project", "projectId", "PROJECT"]

[[rules]]
id = "anthropic-api-key"
description = "Anthropic API Key"
regex = '''sk-ant-[a-zA-Z0-9-_]{32,}'''
tags = ["api", "anthropic"]

[[rules]]
id = "github-token"
description = "GitHub Personal Access Token"
regex = '''ghp_[a-zA-Z0-9]{36,}'''
tags = ["api", "github"]

[[rules]]
id = "github-oauth"
description = "GitHub OAuth Token"
regex = '''gho_[a-zA-Z0-9]{36,}'''
tags = ["api", "github"]

[[rules]]
id = "github-app-token"
description = "GitHub App Token"
regex = '''ghs_[a-zA-Z0-9]{36,}'''
tags = ["api", "github"]

[[rules]]
id = "vercel-token"
description = "Vercel Token"
regex = '''["\']?[a-zA-Z0-9]{24}["\']?'''
tags = ["api", "vercel"]
keywords = ["VERCEL_TOKEN", "vercel"]

[[rules]]
id = "clerk-secret"
description = "Clerk Secret Key"
regex = '''sk_live_[a-zA-Z0-9]{32,}'''
tags = ["api", "clerk"]

[[rules]]
id = "clerk-test-secret"
description = "Clerk Test Secret Key"
regex = '''sk_test_[a-zA-Z0-9]{32,}'''
tags = ["api", "clerk"]

# Allowlist for false positives
[allowlist]
description = "Global allowlist"

# Allow example/placeholder values
regexes = [
  '''lin_api_your_key_here''',
  '''your-.*-uuid''',
  '''example\.com''',
  '''placeholder''',
  '''xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx''',
  # RFC 4122 example UUID (used in documentation)
  '''550e8400-e29b-41d4-a716-446655440000''',
  # Placeholder patterns in documentation
  '''sk_live_xxx''',
  '''sk_test_xxx''',
  '''msk_live_xxx''',
  '''ghp_xxx''',
  '''lin_api_xxx''',
  # SMI-1949: Production Supabase anon key (safe to expose - provides RLS access only)
  # This is intentionally bundled with the MCP server for authenticated API access
  '''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyY256cG1uZHRyb3F4eG9xa3p5.*''',
]

# Allow specific files that contain examples or tests
paths = [
  '''\.env$''',
  '''\.env\.example$''',
  '''\.env\.schema$''',
  '''.*\.test\.(ts|js)$''',
  '''.*\.spec\.(ts|js)$''',
  '''.*fixtures.*''',
  '''.*__mocks__.*''',
  '''tests/.*''',
  '''scripts/.*''',
  '''docs/.*\.md$''',
  '''docs/.*\.yaml$''',
  '''\.claude/skills/.*\.md$''',
  # Hive-mind configs contain Linear project IDs (not secrets)
  '''\.claude/hive-mind/.*\.yaml$''',
  # Lock files contain integrity hashes, not secrets
  '''deno\.lock$''',
  '''package-lock\.json$''',
  '''pnpm-lock\.yaml$''',
  '''yarn\.lock$''',
  '''bun\.lockb$''',
]

# Allow commits that are known to be safe
commits = []
